

<!DOCTYPE html>
<!-- Hello, nice to see you took a peek here :) -->
<!-- Send us an email at hello at brewhouse dot io if you'd like to talk tech -->
<!--[if lt IE 7 ]> <html class="ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]>    <html class="ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]>    <html class="ie8" lang="en"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie9" lang="en"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en"> <!--<![endif]-->

<html lang="en-us" class="blog">
  <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# business: http://ogp.me/ns/business#">

    <title>Five Practices for Robust Ruby on Rails Applications</title>
    <meta property="og:title" content="Five Practices for Robust Ruby on Rails Applications">
    <meta property="og:site_name" content="brewhouse">
    <meta property="og:url" content="http://brewhouse.io/2016/02/26/five-practices-for-robust-ruby-on-rails-applications.html">

    <meta property="og:image" content="http://brewhouse.io/images/brewhouse-symbol-large-200x200.png">

    <meta property="twitter:card" content="summary" />
    <meta property="twitter:site" content="@brewhouseteam" />
    <meta property="twitter:image" content="http://brewhouse.io/images/brewhouse-symbol-large-200x200.png">
    <meta property="twitter:url" content="http://brewhouse.io/2016/02/26/five-practices-for-robust-ruby-on-rails-applications.html">

    <link rel="alternate" type="application/atom+xml" href="/blog/index.xml" title="The Brew Pub atom feed">

    
      <meta property="og:type" content="article">
      <meta property="article:published_time" content="2016-02-26 12:00:00 -0800">
      <meta property="article:tag" content="Philippe Creux">

      <meta property="twitter:title" content="Five Practices for Robust Ruby on Rails Applications">

      
        <meta name="description" content="A few extra keystokes here and there can make a Rails application robust.">
        <meta property="twitter:description" content="A few extra keystokes here and there can make a Rails application robust.">
        <meta property="og:description" content="A few extra keystokes here and there can make a Rails application robust.">
      
    

    <script src="//use.typekit.net/scl6izu.js"></script>
    <script>try{Typekit.load();}catch(e){}</script>

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="robots" content="INDEX, FOLLOW">

<link rel="shortcut icon" href="/images/icons/favicon.ico" type="image/x-icon">
<link rel="apple-touch-icon" href="/images/icons/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="57x57" href="/images/icons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="72x72" href="/images/icons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/images/icons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/images/icons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/images/icons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/images/icons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/images/icons/apple-touch-icon-152x152.png">

<link type="text/css" rel="stylesheet" href="/assets/application.css">


    <!-- needs to be refactored when we have more layouts -->
    

  </head>
  <body class="on-post">
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46725009-2', 'brewhouse.io');
  ga('send', 'pageview');

</script>


    <aside class="offcanvas-menu">
  <ul>
    <li>
      <a class="internal" href="http://brewhouse.io/#work">Work</a>
    </li>
    <li>
      <a class="internal" href="http://brewhouse.io/#services">Services</a>
    </li>
    <li>
      <a href="/meet-the-team.html">Team</a>
    </li>
    <li>
      <a href="/blog">Blog</a>
    </li>
    <li>
      <a href="/show">Podcast</a>
    </li>
  </ul>
  <a class="btn btn--header" href="/work-with-us.html">Hire Us</a>
</aside>

    <nav id="navbar-main" class="navbar navbar-default navbar-main">
  <div class="container">
    <div class="col-xs-12">

      <div class="logo-container">
        <a id="brewhouse-logo" class="navbar-brand internal" rel="home" href="/" title="brewhouse logo"><img src="/images/brewhouse-logo.svg" alt="Brewhouse" class="img-responsive"></a>
      </div>

      <button type="button" class="navbar-toggle navbar-toggle-offcanvas js-navbar-toggle-offcanvas">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="main-menu">
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <a class="internal btn navbar-btn navbar-right btn--header" href="/work-with-us.html">Hire Us</a>
          <ul id="navbar-links" class="nav navbar-nav navbar-right">
            <li><a class="internal" href="/#work">Work</a></li>
            <li><a class="internal" href="/#services">Services</a></li>
            <li><a href="/meet-the-team.html">Team</a></li>
            <li><a href="/blog">Blog</a></li>
            <li><a href="/show">Podcast</a></li>
          </ul>
        </div><!-- /.navbar-collapse -->
      </div>

    </div>

  </div>
</nav>


    <div class="main">

      

<article>

  <div class="page-header">
    <div class="container">
      <div class="col-xs-12 col-sm-8">
        <h1 class="page-title">Five Practices for Robust Ruby on Rails Applications</h1>
      </div>
      <div class="col-xs-12 col-sm-4 text-xs-center">
        <div class="meta text-center">
          
            <div class="author">
              <img class="img-circle img-author" src="//www.gravatar.com/avatar/cf8db14764d6420698b0ed9c9ed1ba93?s=135" alt="A photo of Philippe Creux" width="55">

              <a href="http://twitter.com/pcreux" target="_blank">Philippe Creux</a> 26 Feb 2016
            </div>
          
          <div class="social-actions">
            <a href="https://twitter.com/share?via=BrewhouseTeam" class="twitter-share-button" data-lang="en" data-url="http://brewhouse.io/2016/02/26/five-practices-for-robust-ruby-on-rails-applications.html" data-related="chancancode,kalv,pcreux,chuckbergeron" data-counturl="">Tweet</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="article-start" class="container content">

      <div class="col-xs-12 col-sm-8">

        <div class="post clearfix">

          <p>Whenever I come across a rails application with inconsistent data or bugs that are hard
to nail down I tell myself: “They (the developers) were just a couple of keystokes away from preventing those issues from happening”.</p>

<p>At <a href="http://brewhouse.io">Brewhouse</a>, we follow five simple practices to make our Rails applications robust. It all comes down to failing early, loudly and often. We ensure that data is valid and applications behave properly by catching issues early on.</p>

<!-- break -->

<h2 id="use-hashfetch-to-catch-malformed-hash">Use <code>Hash#fetch</code> to catch malformed hash</h2>

<p><code>unexpected method 'upcase' for nil</code>… Whenever you expect a Hash to contain a key, prefer <code>fetch()</code> over
<code>[]</code>. <code>fetch()</code> will raise an error when the key is missing so you won’t
pass <code>nil</code> values around and see unrelated errors happening down the
line.</p>

<h2 id="case--else-raise-to-catch-invalid-data"><code>case ... else raise</code> to catch invalid data</h2>

<p>Always add an <code>else raise ...</code> clause to your <code>case</code> statements. You
want to know when you’ve received an unexpected value rather than
ignoring it and moving on.</p>

<h2 id="use-activerecord--methods-to-fail-loudly">Use ActiveRecord <code>!</code> methods to fail loudly</h2>

<p>Data is often being seen as the most valuable asset in a company. Failing silently to persist data can have a huge impact then.
Whenever you’re not expecting an operation to fail, use the “bang”
version of <code>create!</code>, <code>update!</code> and <code>destroy!</code> that raise exceptions on
failure. This extra key stroke
will save you from dealing with inconsistent data.</p>

<p>Used in test code, it ensures that the setup doesn’t fail silently…
there is nothing worse than a test that passes because the setup was
incorrect.</p>

<p>Also, always wrap multiple calls into an SQL transaction to prevent your data from getting into an in-between state.</p>

<h2 id="add-activerecord-validations-to-perform-live-checks">Add ActiveRecord validations to perform live checks</h2>

<p>Pairing ActiveRecord validations with the use of ‘bang methods’ is a great way to ensure you persist valid data. For example:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Post</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Model</span>
  <span class="n">validates</span> <span class="ss">:author</span><span class="p">,</span> <span class="ss">:blog</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span>
  <span class="n">validates</span> <span class="ss">:published_by</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="k">if</span><span class="p">:</span> <span class="ss">:published?</span>
  <span class="n">validates</span> <span class="ss">:comment_count</span><span class="p">,</span> <span class="ss">numericality</span><span class="p">:</span> <span class="p">{</span> <span class="ss">greater_or_equal_to</span><span class="p">:</span> <span class="mi">0</span> <span class="p">}</span>
  <span class="c1"># ...</span>
<span class="k">end</span></code></pre></figure>

<h2 id="use-database-constraints-to-ensure-data-consistency">Use database constraints to ensure data consistency</h2>

<p>Your database is your best friend when it comes to ensuring data is
present, not duplicated and that orphans are not left in the database.</p>

<h3 id="null-false"><code>null: false</code></h3>

<p>Given the fact that the large majority of columns are required in a database, you should define columns with <code>null: false</code> by default.</p>

<h3 id="index--unique-true"><code>index ... unique: true</code></h3>

<p>Did you know that rails <code>has_one</code> does not prevent duplicate
associations from being created?</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Account</span>
  <span class="n">has_one</span> <span class="ss">:account_settings</span>
<span class="k">end</span>

<span class="n">account</span> <span class="o">=</span> <span class="no">Account</span><span class="o">.</span><span class="n">create!</span>
<span class="n">account</span><span class="o">.</span><span class="n">create_account_settings!</span>
<span class="n">account</span><span class="o">.</span><span class="n">create_account_settings!</span>
<span class="n">account</span><span class="o">.</span><span class="n">create_account_settings!</span>

<span class="n">account</span><span class="o">.</span><span class="n">account_settings</span>
 <span class="c1"># =&gt; one of the three account settings you&#39;ve created... -_-</span></code></pre></figure>

<p>The best way to prevent this from making data inconsistent is to add a unique index.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">add_index</span> <span class="ss">:account_settings</span><span class="p">,</span> <span class="ss">:account_id</span><span class="p">,</span> <span class="ss">unique</span><span class="p">:</span> <span class="kp">true</span></code></pre></figure>

<p>The database will throw an error if you attempt to persist a duplicate
record.</p>

<h3 id="foreignkey"><code>foreign_key</code></h3>

<p>You don’t want orphan records in your database, do you?</p>

<p>Foreign keys help such things from happening. I’d recommend using the ruby gem
<a href="https://github.com/SchemaPlus/schema_auto_foreign_keys">schema_auto_foreign_keys</a> to automatically add foreign keys on your
behalf.</p>

<h2 id="a-few-extra-keystrokes-goes-a-long-way">A few extra keystrokes goes a long way</h2>

<p>A few extra keystrokes here and there can save you from hours of
debugging or recovering from inconsistent data. Use <code>!</code>, <code>raise</code>,
<code>validate</code> and database constraints. Your coworkers and future-self
will thank you.</p>

<p>As always, feedback is greatly appreciated. I’d be happy to hear of any other practices I didn’t cover here.</p>


        </div><!-- /post -->

        <div class="hire-us-form text-center">
  <h2>Let's Work Together</h2>
  <h3>Find out why our transparent, collaborative process is the best way to make well-loved products.</h3>
  <a href="/work-with-us.html" class="btn btn--blue">Get in touch today</a>
</div>


        <div id="disqus_thread"></div>

        <!-- disqus -->
        <script type="text/javascript">
            var disqus_shortname = 'brewhouse';
            var disqus_url = 'http://brewhouse.io/2016/02/26/five-practices-for-robust-ruby-on-rails-applications.html';

            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        <!-- /disqus -->

      </div>

  </div><!-- /content-->

</article>

<script>
  !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
</script>


    </div>

    <aside class="lets-talk cover">
  <div class="container">
    <div class="col-md-6">
      <p class="lede">We partner with businesses to design and develop well-loved products through a flexible and transparent process. We'd love to discuss how our process can help your idea become a reality.</p>
    </div>
  </div>
  <div class="container">
    <div class="col-md-6">
      <a href="http://maps.apple.com/?q=210%20Carrall,+Vancouver,+Canada">#303 - 210 Carrall St, Vancouver, BC
      V6B 2J1</a><br>
      <a href="tel:+16047574242">+1 604-757-4242</a> &middot;
      <a href="mailto:hello@brewhouse.io">hello@brewhouse.io</a> &middot;
      <a href="http://twitter.com/brewhouseteam">@brewhouseteam</a>
    </div>
    <div class="col-md-5 col-md-offset-1">
      <a href="/work-with-us.html" class="btn btn--footer">Hire Us</a>
    </div>
  </div>
</aside>


    <footer id="footer">
  <div class="container">
    <nav role="navigation" class="col-md-6">
        <ul>
          <li>
            <a class="internal" href="/#work">Work</a>
          </li>
          <li>
            <a class="internal" href="/meet-the-team.html">Team</a>
          </li>
          <li>
            <a class="internal" href="/blog">Blog</a>
          </li>          
          <li>
            <a class="internal" href="/show">Podcast</a>
          </li>
        </ul>
    </nav>
    <div class="col-md-5 col-md-push-1">
      <p class="copyright">
        &copy; <span class="copyright-year"></span> <a href="http://brewhouse.io">brewhouse software, inc.</a>
      </p>
    </div>
  </div>
</footer>


    <script type="text/javascript" src="/assets/app.js"></script>

    <!-- needs to be refactored when we have more layouts -->
    

  </body>
</html>
