

<!-- Nice to see you took a peek here, hello -->
<!-- send us an email at hello at brewhouse dot io if you want to talk tech -->

<!DOCTYPE html>
<!--[if lt IE 7 ]> <html class="ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]>    <html class="ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]>    <html class="ie8" lang="en"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie9" lang="en"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en"> <!--<![endif]-->

<html lang="en-us" class="blog">
  <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# business: http://ogp.me/ns/business#">

    <title>Say Hello to Roundup Roger</title>
    <meta property="og:title" content="Say Hello to Roundup Roger">
    <meta property="og:site_name" content="brewhouse">
    <meta property="og:url" content="http://brewhouse.io/2014/06/27/say-hello-to-roundup-roger.html">

    <meta property="og:image" content="http://brewhouse.io/images/brewhouse-symbol-large-200x200.png">

    <meta property="twitter:card" content="summary" />
    <meta property="twitter:site" content="@brewhouseteam" />
    <meta property="twitter:image" content="http://brewhouse.io/images/brewhouse-symbol-large-200x200.png">
    <meta property="twitter:url" content="http://brewhouse.io//2014/06/27/say-hello-to-roundup-roger.html">

    <link rel="alternate" type="application/atom+xml" href="/blog/index.xml" title="The Brew Pub atom feed">

    
      <meta property="og:type" content="article">
      <meta property="article:published_time" content="2014-06-27">
      <meta property="article:tag" content="Jenn Cooper">

      <meta property="twitter:title" content="Say Hello to Roundup Roger">

      
    

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="robots" content="INDEX, FOLLOW">

<link rel="shortcut icon" href="/images/icons/favicon.ico" type="image/x-icon">
<link rel="apple-touch-icon" href="/images/icons/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="57x57" href="/images/icons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="72x72" href="/images/icons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/images/icons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/images/icons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/images/icons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/images/icons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/images/icons/apple-touch-icon-152x152.png">

<link rel="stylesheet" href="/assets/application-8d1cf7a745d3c9615a74037d119653db.css">

  </head>
  <body class="on-post">
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46725009-2', 'brewhouse.io');
  ga('send', 'pageview');

</script>


    <nav id="navbar-blog" class="navbar navbar-default navbar-main" role="navigation">
      <a id="brewhouse-logo" class="navbar-brand internal" rel="home" href="/" title="brewhouse logo"><img src="/images/brewhouse-logo-blog-2.png"></a>
    </nav>

    <div class="container main">
      <div class="body-border-top">
</div>
<div id="banner-blog" class="row">
  <div class="banner-content">
    <section class="col-xs-12 col-sm-5">
      <h1 id="brew-pub-start">
        <a href="/blog/"><img src="/images/blog-brew-pub-logo.png"></a>
      </h1>
      <h3>
        Writings from <a href="http://brewhouse.io">brewhouse.io</a>, makers of <a href="https://goodbits.io?utm_source=brewhouse-blog">Goodbits</a> and superb apps for our clients.
      </h3>
    </section>
    <section class="col-xs-12 col-sm-4">
      <p class="blog-contact-info">
        email <a href="mailto:hello@brewhouse.io">hello@brewhouse.io</a>
        <br>or, give us a call <a class="telephone" href="tel:+16046147784">+1 604-757-4242</a>
      </p>
    </section>
  </div>
</div>


      

<div id="article-start" class="content">
  <div class="row">
    <div class="col-xs-12 col-sm-9">

      <div class="post">
        <div class="social-actions">
          <a href="https://twitter.com/share?via=BrewhouseTeam" class="twitter-share-button" data-lang="en" data-url="http://brewhouse.io/2014/06/27/say-hello-to-roundup-roger.html" data-related="chancancode,kalv,pcreux,chuckbergeron" data-counturl="">Tweet</a>
        </div>

        <h1>
          Say Hello to Roundup Roger
        </h1>
        <p class="meta">
          
            <span>
              <img class="img-circle img-author" src="//www.gravatar.com/avatar/431315f0018a1c697f449304c96dcfff?s=135" alt="A photo of Jenn Cooper" width="55">

              <a href="http://twitter.com/jncoops" target="_blank">Jenn Cooper</a> wrote this on 27 Jun 2014
            </span>
          
        </p>

        <p>
  <a href="https://github.com/BrewhouseTeam/roundup-roger">
    <img class="img-right img-responsive" alt="This Week in Rails Logo" src="https://s3.amazonaws.com/roundup-roger/roundup_roger_logo1.png" />
  </a>
</p>

<p>At Brewhouse, we spend Fridays doing creative work. During these wonderful days, we focus on interesting hacks and innovative projects. Over the last 10 weeks, I’ve been able to spend my Fridays working on a project with <a href="https://github.com/pcreux">Philippe Creux</a> called <a href="https://github.com/BrewhouseTeam/roundup-roger">Roundup Roger</a>. Roundup Roger is an open source tool to wrap-up a team’s day via email. A wrap-up is quite similar to an agile standup (or scrum), but at the end of the business day.</p>

<p>You’re probably thinking, “How anti-social of you!”.  Yes, you’re right, we’re endorsing email correspondence over face-to-face interaction. But we’re talking about wrap-up meetings here, not beer Fridays.</p>

<p>The point of a wrap-up is to educate the team on:</p>

<ul>
  <li>What you’ve accomplished during the last business day</li>
  <li>What you’ll be working on next</li>
  <li>Whether you’ve hit any blockers that are impeding your progress</li>
</ul>

<!-- break -->

<p>Email works well in this situation because it prevents <em>Chatty Carls</em> from commandeering your meeting, and allows concise discourse that can be re-visited later if needed. Also, for those of us who have trouble with <a href="http://www.joelonsoftware.com/articles/fog0000000022.html">context switching</a>, it can be easier to communicate the work you’ve accomplished by writing it out as opposed to communicating verbally.</p>

<p>Another benefit of an email wrap-up is a flexible response time. Some of our team members finish later in the day than others, and often accomplish a lot after the in-person wrap-up happens. With Roundup Roger, team members have the flexibility to respond to the reminder email at any time. As long as they send their email before the roundup is sent in the morning, their contributions will be included.</p>

<h2 id="how-does-roundup-roger-work">How Does Roundup Roger Work?</h2>

<p>Reminder emails are sent out daily at a scheduled time. Each team member responds to the reminder email:</p>

<p><img src="/images/posts/reminder-email.png" alt="reminder email" /></p>

<hr />

<p>The following day, a roundup email is sent to the entire team with each member’s contributions from the previous day:</p>

<p><img src="/images/posts/roundup-email.png" alt="roundup email" /></p>

<h2 id="technical-details">Technical Details</h2>

<p>Roundup Roger is a <a href="http://www.sinatrarb.com/">Sinatra</a> app, that capitalizes on <a href="https://github.com/jeremyevans/sequel">Sequel’s</a> ORM layer.</p>

<p>After using <a href="http://rubyonrails.org/">Rails</a> over the last couple of years, I had become soft. It’s not the best realization to find you’ve become accustomed to having everything done for you. It took me a few weeks to stop trying to use <a href="http://guides.rubyonrails.org/active_record_querying.html">ActiveRecord</a> when querying the database and in the end, I had a good cry and got over myself. I then became much better at using the Sequel gem’s ORM layer.</p>

<p>I’ve also realized that Sinatra is not really a framework at all, but more of a library. I suppose this is why people call it a ‘micro-framework’.</p>

<p>“Hey Sinatra! Thanks for nothing!”</p>

<p>Jokes aside, Sinatra ended up being a great tool to solve this problem. As it turns out, we didn’t really need much of the ‘good stuff’ that comes along with Rails. The app itself doesn’t have a web UI and is meant to be run solely via scheduled tasks in production.</p>

<h3 id="building-emails">Building Emails</h3>

<p>To build emails, we used <a href="https://github.com/solnic/virtus">Virtus</a> to create a common interface for defining attributes. It allowed us to do things like this:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">OutboundEmail</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">to</span><span class="p">:</span> <span class="n">recipients</span><span class="p">,</span> <span class="ss">body</span><span class="p">:</span> <span class="n">body</span><span class="p">,</span> <span class="ss">subject</span><span class="p">:</span> <span class="n">subject</span><span class="p">)</span></code></pre></div>

<p>When a user replies to a reminder email, we retrieve the payload passed from <a href="https://www.mandrill.com/">Mandrill</a>, and grab the name, email and body, such that we can later apply these to the roundup email.</p>

<p>When we build the roundup email, we strip each email body to remove signatures. This was somewhat tricky, as different email clients apply signatures differently.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">PATTERNS</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;—\n+Sent&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;? ?On&#39;</span><span class="o">].</span><span class="n">freeze</span>

  <span class="k">def</span> <span class="nf">stripped_body</span>
    <span class="no">PATTERNS</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">pattern</span><span class="o">|</span>
      <span class="nb">self</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">strip_pattern</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="n">body</span><span class="o">.</span><span class="n">strip</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">strip_pattern</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
    <span class="n">body</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/\n(</span><span class="si">#{</span><span class="n">pattern</span><span class="si">}</span><span class="sr">| [^\n]+\n?[^\n]+\n+\&gt;).*/m</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
  <span class="k">end</span></code></pre></div>

<p>We then separate each person’s contribution with a random ascii separator, because, WHY NOT?</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">separator</span>
    <span class="o">[</span>
      <span class="s2">&quot;█║▌│ █│║▌ ║││█║▌ │║║█║ │║║█║ █│║▌&quot;</span><span class="p">,</span>
      <span class="s2">&quot;▇ ▅ █ ▅ ▇ ▂ ▃ ▁ ▁ ▅ ▃ ▅ ▅ ▄ ▅&quot;</span><span class="p">,</span>
      <span class="s2">&quot;★★★★★★★★★★★★★★★★★★&quot;</span><span class="p">,</span>
      <span class="s2">&quot;&quot;</span><span class="p">,</span>
      <span class="o">].</span><span class="n">sample</span>
  <span class="k">end</span></code></pre></div>

<h3 id="sending-emails">Sending Emails</h3>

<p>We use <a href="https://github.com/benprew/pony">Pony</a> to send emails. This is where the magic happens…</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">SendOutboundEmail</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">call</span><span class="p">(</span><span class="n">email</span><span class="p">)</span>
    <span class="no">Pony</span><span class="o">.</span><span class="n">mail</span><span class="p">({</span>
      <span class="ss">:to</span> <span class="o">=&gt;</span> <span class="n">email</span><span class="o">.</span><span class="n">to</span><span class="p">,</span>
      <span class="ss">:from</span> <span class="o">=&gt;</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;EMAIL_FROM&#39;</span><span class="o">]</span><span class="p">,</span>
      <span class="ss">:subject</span> <span class="o">=&gt;</span> <span class="n">email</span><span class="o">.</span><span class="n">subject</span><span class="p">,</span>
      <span class="ss">:html_body</span> <span class="o">=&gt;</span> <span class="n">email</span><span class="o">.</span><span class="n">body</span><span class="p">,</span>
      <span class="ss">:via</span> <span class="o">=&gt;</span> <span class="ss">:smtp</span><span class="p">,</span>
      <span class="ss">:via_options</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="ss">:address</span>        <span class="o">=&gt;</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;SMTP_ADDRESS&#39;</span><span class="o">]</span><span class="p">,</span>
        <span class="ss">:port</span>           <span class="o">=&gt;</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;SMTP_PORT&#39;</span><span class="o">]</span><span class="p">,</span>
        <span class="ss">:enable_starttls_auto</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span>
        <span class="ss">:user_name</span>      <span class="o">=&gt;</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;SMTP_USER_NAME&#39;</span><span class="o">]</span><span class="p">,</span>
        <span class="ss">:password</span>       <span class="o">=&gt;</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;SMTP_PASSWORD&#39;</span><span class="o">]</span><span class="p">,</span>
        <span class="ss">:authentication</span> <span class="o">=&gt;</span> <span class="ss">:plain</span>
      <span class="p">}</span>
    <span class="p">})</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<h3 id="scheduling-and-business-time">Scheduling and Business Time</h3>

<p>We use the <a href="https://github.com/bokmann/business_time">Business Time</a> gem to prevent reminders and roundups from being sent on weekends. Perhaps this item should be configurable for those of you who like to work on weekends (why??).</p>

<p>The Heroku Scheduler plans our tasks for daily execution.</p>

<p>We’d like to think setup is pretty simple. Just schedule the following two rake tasks based on your team’s needs:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">rake</span> <span class="n">send_reminders</span></code></pre></div>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">rake</span> <span class="n">send_roundup</span></code></pre></div>

<p>There is also a <code>send_test_email</code> rake task to test whether SMTP settings are configured correctly.</p>

<h2 id="we-use-this">We Use This</h2>

<p>Since we like to <a href="http://brewhouse.io/blog/2014/04/24/this-week-in-rails-the-backstory.html#dogfooding">eat our own dog food</a> at Brewhouse, we’ve been using Roundup Roger as part of our daily efforts for the last couple of months. Our hope is that others will find the same value that we’ve found. The more teams that try this out, the more we’ll know about how to improve it. As always, feedback and contributions are welcome.</p>

<p><a href="https://github.com/BrewhouseTeam/roundup-roger">Give it a try!</a></p>



        <div class="mailchimp-form text-center">
          <p>
            Stay up to date with us here at the BrewPub:
          </p>
          <!-- Begin MailChimp Signup Form -->
          <link href="//cdn-images.mailchimp.com/embedcode/slim-081711.css" rel="stylesheet" type="text/css">
          <div id="mc_embed_signup" class="row">
            <form action="http://brewhouse.us8.list-manage.com/subscribe/post?u=c524f6473f5901cae1230a052&amp;id=14f9de4be1" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>

              <div class="col-sm-offset-1 col-sm-6">
                <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="your email address" required style="width: 100%; margin: 0 0 4% 0">
              </div>
              <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
              <div style="position: absolute; left: -5000px;">
                <input type="text" name="b_c524f6473f5901cae1230a052_14f9de4be1" value="">
              </div>

              <div class="col-sm-4 subscribe-button">
                <input type="submit" value="SIGN UP NOW" name="subscribe" id="mc-embedded-subscribe" class="button">
              </div>
            </form>
          </div>
          <!--End mc_embed_signup-->
        </div>

        <div id="disqus_thread"></div>

        <!-- disqus -->
        <script type="text/javascript">
            var disqus_shortname = 'brewhouse';
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        <!-- /disqus -->

      </div><!-- /post -->

    </div>
  </div><!-- /row -->
</div><!-- /content-->

<script>
  !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
</script>

    </div>

    <footer>
      <div class="container">
        <div class="row">
          <section class="col-xs-11 col-xs-offset-1">
            <p class="blog-contact-info">
              email <a href="mailto:hello@brewhouse.io">hello@brewhouse.io</a>
              <br>or, give us a call <a class="telephone" href="tel:+16046147784">+1 604-757-4242</a>
            </p>
          </section>
        </div>
        <div class="row">
          <div class="col-xs-11 col-xs-offset-1">
            <p>
              &copy; <span class="copyright-year"></span> <a href="http://brewhouse.io">brewhouse software, inc.</a>
            </p>
          </div><!--col-xs-12 -->
        </div><!-- row -->
      </div><!-- container -->
    </footer>

    <script src="/assets/app-cc3981e2c3b790fd87a89c93a99433de.js"></script>
  </body>
</html>
