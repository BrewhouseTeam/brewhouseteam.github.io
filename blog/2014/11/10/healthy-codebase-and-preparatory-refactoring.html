

<!-- Nice to see you took a peek here, hello -->
<!-- send us an email at hello at brewhouse dot io if you want to talk tech -->

<!DOCTYPE html>
<!--[if lt IE 7 ]> <html class="ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]>    <html class="ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]>    <html class="ie8" lang="en"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie9" lang="en"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en"> <!--<![endif]-->

<html lang="en-us" class="blog">
  <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# business: http://ogp.me/ns/business#">

    <title>Healthy Codebase and Preparatory Refactoring</title>
    <meta property="og:title" content="Healthy Codebase and Preparatory Refactoring">
    <meta property="og:site_name" content="brewhouse">
    <meta property="og:url" content="http://brewhouse.io/blog/2014/11/10/healthy-codebase-and-preparatory-refactoring.html">

    <meta property="og:image" content="http://brewhouse.io/images/posts/2014/Nov/preparatory-refactoring-square.jpg">

    <meta property="twitter:card" content="summary" />
    <meta property="twitter:site" content="@brewhouseteam" />
    <meta property="twitter:image" content="http://brewhouse.io/images/posts/2014/Nov/preparatory-refactoring-square.jpg">
    <meta property="twitter:url" content="http://brewhouse.io//blog/2014/11/10/healthy-codebase-and-preparatory-refactoring.html">

    <link rel="alternate" type="application/atom+xml" href="/blog/index.xml" title="The Brew Pub atom feed">

    
      <meta property="og:type" content="article">
      <meta property="article:published_time" content="2014-11-10">
      <meta property="article:tag" content="Philippe Creux">

      <meta property="twitter:title" content="Healthy Codebase and Preparatory Refactoring">

      
        <meta name="description" content="Beautiful words and powerful metaphors to illustrate how keeping a Healthy Codebase and doing Prepartory Refactoring speed up development.">
        <meta property="twitter:description" content="Beautiful words and powerful metaphors to illustrate how keeping a Healthy Codebase and doing Prepartory Refactoring speed up development.">
        <meta property="og:description" content="Beautiful words and powerful metaphors to illustrate how keeping a Healthy Codebase and doing Prepartory Refactoring speed up development.">
      
    

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="robots" content="INDEX, FOLLOW">

<link rel="shortcut icon" href="/images/icons/favicon.ico" type="image/x-icon">
<link rel="apple-touch-icon" href="/images/icons/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="57x57" href="/images/icons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="72x72" href="/images/icons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/images/icons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/images/icons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/images/icons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/images/icons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/images/icons/apple-touch-icon-152x152.png">

<link href="http://fonts.googleapis.com/css?family=Lato:300,400" rel="stylesheet" type="text/css">

<link rel="stylesheet" href="/assets/application-56c6ca3a100397de6a61df87737630b6.css">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/foundicons/3.0.0/foundation-icons.css">

  </head>
  <body class="on-post">
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46725009-2', 'brewhouse.io');
  ga('send', 'pageview');

</script>


    <nav id="navbar-blog" class="navbar navbar-default navbar-main" role="navigation">
      <a id="brewhouse-logo" class="navbar-brand internal" rel="home" href="/" title="brewhouse logo"><img src="/images/brewhouse-logo-blog-2.png"></a>
    </nav>

    <div class="container main">
      <div id="banner-blog" class="row">
  <div class="col-xs-12 img-full-width">
    <img src="/images/blog-background.jpg" class="img-responsive">

    <section>
      <h1 id="brew-pub-start">
        <a href="/blog/">The Brew Pub</a>
      </h1>
      <h3>
        Writings from <a href="http://brewhouse.io">brewhouse.io</a>, makers of <a href="https://goodbits.io?utm_source=brewhouse-blog">goodbits.io</a> and stellar apps for our clients.
      </h3>
    </section>
  </div>
</div>


      

<div id="article-start" class="content">
  <div class="row">
    <div class="col-xs-12 col-sm-9">

      <div class="post">
        <div class="social-actions">
          <a href="https://twitter.com/share?via=BrewhouseTeam" class="twitter-share-button" data-lang="en" data-url="http://brewhouse.io/blog/2014/11/10/healthy-codebase-and-preparatory-refactoring.html" data-related="chancancode,kalv,pcreux,chuckbergeron" data-counturl="">Tweet</a>
        </div>

        <h1>
          Healthy Codebase and Preparatory Refactoring
        </h1>
        <p class="meta">
          
            <span>
              <img class="img-circle img-author" src="//www.gravatar.com/avatar/cf8db14764d6420698b0ed9c9ed1ba93?s=135" alt="A photo of Philippe Creux" width="55">

              <a href="http://twitter.com/pcreux" target="_blank">Philippe Creux</a> wrote this on 10 Nov 2014
            </span>
          
        </p>

        <p>In a <a href="http://devchat.tv/ruby-rogues/178-rr-book-club-refactoring-ruby-with-martin-fowler">recent episode of the RubyRogues podcast</a>, <a href="http://martinfowler.com">Martin Fowler</a> and <a href="https://twitter.com/jessitron">Jessica Kerr</a> literally spoke my mind. They named two concepts that I deeply believe in and care about: Healthy Codebase and Preparatory Refactoring. The fact that they have expressed them in beautiful words and powerful metaphors enables me to share them with you in this article.</p>

<!-- break -->

<p>After 43 minutes of discussions on the steps of refactoring, Martin introduced the concept of Healthy Codebase.</p>

<p>“<em>A healthy codebase allows you to keep going fast. You’re slowed down by having stuff that’s unclear.</em>”, says Martin. <em>“The analogy is often made between code and writing. And of course, this is part of the theme of <a href="http://www.confreaks.com/videos/3315-railsconf-keynote-writing-software">David’s RailsConf talk</a> that was so controversial, that he thinks of code not as mathematics but as writing. And I’m very much in agreement with him on this. But that has a consequence which says that if code is writing, it means you have to put a lot of effort into making it clear. And ask any good rewriter what they do most of the time, and it’s rewriting.”</em></p>

<p>We have to realize that unclear code slows us down. It is <em>“an economic judgment”</em> that code quality results in speed. So the <em>“Code quality versus Speed”</em> is nonsense.</p>

<p><em>“Many times, I run into teams that say: ‘Management isn’t allowing us to do a quality job here because it will slow us down. And we’ve appealed to management and said we need to put more quality in the code, but they’ve said no, we need to go faster instead’. And my comment to that is that as soon as you’re framing it in terms of code quality versus speed, you’ve lost. Because the whole point of refactoring is to go faster.”</em></p>

<p><img src="/images/posts/2014/Nov/code-quality-speed-chart.jpg" alt="Speed goes with code quality" /></p>

<p>Martin then illustrates his metaphor of the “Healthy Codebase”:</p>

<p><em>“If you keep yourself healthy then you’ll be able to run faster. But if you just say: ‘Well, I want to run a lot so I’m therefore going to run a whole load all the time and not eat properly and not pay attention about this shooting pain going up my leg’, then you’re not going to be able to run quickly very long. You have to pay attention to your health. And same with the codebase. You have to continuously say: ‘How do we keep it in a healthy state?’ Then we can go fast, because we’re running marathons here with codebases. And if we neglect that internal quality of the codebase, it hits you surprisingly fast.”</em></p>

<p>So a “Healthy codebase” is a well written codebase that is clean and easy to understand. Keeping a codebase healthy allows us to move fast. But how do we ensure that we take some time to refactor before moving on to the next task? <a href="https://twitter.com/cmaxw">Charles Max Wood</a> asks this exact question: <em>“A lot of people pick up TDD and they do red, green and go to the next ticket. How do you get to the point where you actually have [the refactoring step] as part of your workflow and make it automatic?”</em></p>

<p>This is where Jessica Kerr jumps in to talk about Preparatory Refactoring and illustrates it with a beautiful metaphor.</p>

<p><em>“So, my strategy is before the red test […] I’m going to go refactor the code […] to make the change I want to make really easy. It’s like I want to go 100 miles east but instead of just traipsing through the woods, I’m going to drive 20 miles north to the highway and then I’m going to go 100 miles east at three times the speed I could have if I just went straight there. When people are pushing you to just go straight there, sometimes you need to say, ‘Wait, I need to check the map and find the quickest route’. The preparatory refactoring does that for me. And plus, it puts the refactoring at the beginning so it’s sure to get done.”</em></p>

<p><img src="/images/posts/2014/Nov/preparatory-refactoring-map.jpg" alt="Look at the map" /></p>

<p>Preparatory Refactoring has some great benefits as it makes you go through the following steps:</p>

<ul>
  <li>1 - understand the architecture of the code you are about to change</li>
  <li>2 - plan and design the changes you are about to make</li>
  <li>3 - refactor the code while you are still in the confortable “green” zone</li>
  <li>4 - share the code resulting from the refactoring step (it can be reviewed and deployed separately from the new functionality)</li>
  <li>5 - write the code for the new functionality (it is easy and fast since the codebase is ready for this change)</li>
</ul>

<p>As Martin describes:</p>

<p><em>“[This process] asks you ‘What would this code need to look like to make this change I’m about to make simple?’ So, you ask yourself that question and then you say, ‘Well, can I refactor it to be like that?’ and then make the change. And if you can do that, it’s almost always going to be faster because in the refactoring step, you’re not going to be in debug land. It’s a relatively straightforward process. And then you’ve made the hard part, which is adding the new functionality, a hell of a lot easier.”</em></p>

<p>I am very grateful to <a href="http://martinfowler.com">Martin Fowler</a> and <a href="https://twitter.com/jessitron">Jessica Kerr</a> for expressing Healthy Codebase and Preparatory Refactoring in such clear words and powerful analogies. I hope that they have convinced you to experiment with these concepts unless you are already enjoying their benefits.</p>


        <div class="mailchimp-form text-center">
          <p>
            Stay updated with more from the BrewPub:
          </p>
          <!-- Begin MailChimp Signup Form -->
          <link href="//cdn-images.mailchimp.com/embedcode/slim-081711.css" rel="stylesheet" type="text/css">
          <div id="mc_embed_signup" class="row">
            <form action="http://brewhouse.us8.list-manage.com/subscribe/post?u=c524f6473f5901cae1230a052&amp;id=14f9de4be1" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>

              <div class="col-sm-offset-1 col-sm-6">
                <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required style="width: 100%; margin: 0 0 4% 0">
              </div>
              <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
              <div style="position: absolute; left: -5000px;">
                <input type="text" name="b_c524f6473f5901cae1230a052_14f9de4be1" value="">
              </div>

              <div class="col-sm-4 subscribe-button">
                <input type="submit" value="Join Now!" name="subscribe" id="mc-embedded-subscribe" class="button">
              </div>
            </form>
          </div>
          <!--End mc_embed_signup-->
        </div>

        <div id="disqus_thread"></div>

        <!-- disqus -->
        <script type="text/javascript">
            var disqus_shortname = 'brewhouse';
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        <!-- /disqus -->

      </div><!-- /post -->

    </div>
  </div><!-- /row -->
</div><!-- /content-->

<script>
  !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
</script>

    </div>

    <footer>
      <div class="container">
        <div class="row">
          <div class="col-xs-11 col-xs-offset-1">
            <p>
              &copy; 2014 <a href="http://brewhouse.io">brewhouse software, inc.</a>
            </p>
          </div><!--col-xs-12 -->
        </div><!-- row -->
      </div><!-- container -->
    </footer>

    <script src="/assets/app-d2b50542eb2234dffdd5932a70b4af3b.js"></script>
  </body>
</html>
