

<!DOCTYPE html>
<!-- Hello, nice to see you took a peek here :) -->
<!-- Send us an email at hello at brewhouse dot io if you'd like to talk tech -->
<!--[if lt IE 7 ]> <html class="ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]>    <html class="ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]>    <html class="ie8" lang="en"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie9" lang="en"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en"> <!--<![endif]-->

<html lang="en-us" class="blog">
  <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# business: http://ogp.me/ns/business#">

    <title>Authentication made simple in Single Page AngularJS Applications</title>
    <meta property="og:title" content="Authentication made simple in Single Page AngularJS Applications">
    <meta property="og:site_name" content="brewhouse">
    <meta property="og:url" content="http://brewhouse.io/blog/2014/12/09/authentication-made-simple-in-single-page-angularjs-applications.html">

    <meta property="og:image" content="http://brewhouse.io/images/brewhouse-symbol-large-200x200.png">

    <meta property="twitter:card" content="summary" />
    <meta property="twitter:site" content="@brewhouseteam" />
    <meta property="twitter:image" content="http://brewhouse.io/images/brewhouse-symbol-large-200x200.png">
    <meta property="twitter:url" content="http://brewhouse.io/blog/2014/12/09/authentication-made-simple-in-single-page-angularjs-applications.html">

    <link rel="alternate" type="application/atom+xml" href="/blog/index.xml" title="The Brew Pub atom feed">

    
      <meta property="og:type" content="article">
      <meta property="article:published_time" content="2014-12-09 08:00:00 -0800">
      <meta property="article:tag" content="Gabe Scholz">

      <meta property="twitter:title" content="Authentication made simple in Single Page AngularJS Applications">

      
        <meta name="description" content="How you integrate features such as a login modal are important so that they don't become a crutch in your application.">
        <meta property="twitter:description" content="How you integrate features such as a login modal are important so that they don't become a crutch in your application.">
        <meta property="og:description" content="How you integrate features such as a login modal are important so that they don't become a crutch in your application.">
      
    

    <script src="//use.typekit.net/scl6izu.js"></script>
    <script>try{Typekit.load();}catch(e){}</script>

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="robots" content="INDEX, FOLLOW">

<link rel="shortcut icon" href="/images/icons/favicon.ico" type="image/x-icon">
<link rel="apple-touch-icon" href="/images/icons/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="57x57" href="/images/icons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="72x72" href="/images/icons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/images/icons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/images/icons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/images/icons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/images/icons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/images/icons/apple-touch-icon-152x152.png">

<link type="text/css" rel="stylesheet" href="/assets/application.css">


    <!-- needs to be refactored when we have more layouts -->
    

  </head>
  <body class="on-post">
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46725009-2', 'brewhouse.io');
  ga('send', 'pageview');

</script>


    <aside class="offcanvas-menu">
  <ul>
    <li>
      <a class="internal" href="http://brewhouse.io/#work">Work</a>
    </li>
    <li>
      <a class="internal" href="http://brewhouse.io/#services">Services</a>
    </li>
    <li>
      <a href="/meet-the-team.html">Team</a>
    </li>
    <li>
      <a href="/blog">Blog</a>
    </li>
    <li>
      <a href="/show">Podcast</a>
    </li>
  </ul>
  <a class="btn btn--header" href="/work-with-us.html">Hire Us</a>
</aside>

    <nav id="navbar-main" class="navbar navbar-default navbar-main">
  <div class="container">
    <div class="col-xs-12">

      <div class="logo-container">
        <a id="brewhouse-logo" class="navbar-brand internal" rel="home" href="/" title="brewhouse logo"><img src="/images/brewhouse-logo.svg" alt="Brewhouse" class="img-responsive"></a>
      </div>

      <button type="button" class="navbar-toggle navbar-toggle-offcanvas js-navbar-toggle-offcanvas">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="main-menu">
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <a class="internal btn navbar-btn navbar-right btn--header" href="/work-with-us.html">Hire Us</a>
          <ul id="navbar-links" class="nav navbar-nav navbar-right">
            <li><a href="/blog">Blog</a></li>
            <li><a href="/show">Podcast</a></li>
          </ul>
        </div><!-- /.navbar-collapse -->
      </div>

    </div>

  </div>
</nav>


    <div class="main">

      

<article>

  <div class="page-header">
    <div class="container">
      <div class="col-xs-12 col-sm-8">
        <h1 class="page-title">Authentication made simple in Single Page AngularJS Applications</h1>
      </div>
      <div class="col-xs-12 col-sm-4 text-xs-center">
        <div class="meta text-center">
          
            <div class="author">
              <img class="img-circle img-author" src="//www.gravatar.com/avatar/667f2b767c362d9291bf2e7afa3de5fd?s=135" alt="A photo of Gabe Scholz" width="55">

              <a href="http://twitter.com/gabescholz" target="_blank">Gabe Scholz</a> 09 Dec 2014
            </div>
          
          <div class="social-actions">
            <a href="https://twitter.com/share?via=BrewhouseTeam" class="twitter-share-button" data-lang="en" data-url="http://brewhouse.io/blog/2014/12/09/authentication-made-simple-in-single-page-angularjs-applications.html" data-related="chancancode,kalv,pcreux,chuckbergeron" data-counturl="">Tweet</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="article-start" class="container content">

      <div class="col-xs-12 col-sm-8">

        <div class="post clearfix">

          <p>The following is a login pattern that I’ve been using in all of my single page AngularJS applications (SPA). We recently introduced it into a client project at Brewhouse, so I thought I would share.</p>

<p>Login on an SPA can be tough and it’s important that your integration doesn’t interfere with the flow of your application. It can become a crutch if you’re not really sure whether the user is
authenticated and resorting to explicit checks all over the place. Here we lay the groundwork for a login modal that is called implicitly only when it’s needed, without almost any knowledge from the rest of the application.</p>

<!-- break -->

<h2 id="the-conditions">The conditions</h2>

<p>There are only three points in the application where the login modal should appear:</p>

<ol>
  <li>When I’m on a welcome page and I click “Login”.</li>
  <li>When I am not logged in and I attempt to visit a page that requires login, <em>e.g.</em> my profile page.</li>
  <li>When I attempt to make a request that requires a login, <em>e.g.</em> my session has expired whilst I’m attempting to post something.</li>
</ol>

<p>We will ignore the first condition as it is trivial.</p>

<h2 id="determining-which-pages-require-a-logged-in-user">Determining which pages require a logged in user</h2>

<p>There are many advantages to using <code>ui-router</code> over <code>ngRoute</code> and in this case we will be taking advantage of how we can attach additional properties to a route and how those properties will cascade
down to the children of that route. In the following code, we make sure to set a <code>requireLogin</code> property for each state.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// routes.js</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$stateProvider</span><span class="p">)</span> <span class="p">{</span>

  <span class="nx">$stateProvider</span>
    <span class="p">.</span><span class="nx">state</span><span class="p">(</span><span class="s1">&#39;welcome&#39;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;/welcome&#39;</span><span class="p">,</span>
      <span class="c1">// ...</span>
      <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">requireLogin</span><span class="o">:</span> <span class="kc">false</span>
      <span class="p">}</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">state</span><span class="p">(</span><span class="s1">&#39;app&#39;</span><span class="p">,</span> <span class="p">{</span>
      <span class="kr">abstract</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="c1">// ...</span>
      <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">requireLogin</span><span class="o">:</span> <span class="kc">true</span> <span class="c1">// this property will apply to all children of &#39;app&#39;</span>
      <span class="p">}</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">state</span><span class="p">(</span><span class="s1">&#39;app.dashboard&#39;</span><span class="p">,</span> <span class="p">{</span>
      <span class="c1">// child state of `app`</span>
      <span class="c1">// requireLogin === true</span>
    <span class="p">})</span>

<span class="p">});</span></code></pre></figure>

<p>Clearly, for routes that do not require a login we set <code>requireLogin</code> to false. We could leave this <code>undefined</code>, but I prefer to show my intent.</p>

<h2 id="capturing-attempted-state-changes">Capturing attempted state changes</h2>

<p>At this point, we can start capturing attempted state changes and inspecting them for our <code>requireLogin</code> property. The following shows how we are going to subscribe to <code>ui-router</code>’s <code>$stateChangeStart</code> event.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// app.js</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$rootScope</span><span class="p">)</span> <span class="p">{</span>

  <span class="nx">$rootScope</span><span class="p">.</span><span class="nx">$on</span><span class="p">(</span><span class="s1">&#39;$stateChangeStart&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">toState</span><span class="p">,</span> <span class="nx">toParams</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">requireLogin</span> <span class="o">=</span> <span class="nx">toState</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">requireLogin</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">requireLogin</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">$rootScope</span><span class="p">.</span><span class="nx">currentUser</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
      <span class="c1">// get me a login modal!</span>
    <span class="p">}</span>
  <span class="p">});</span>

<span class="p">});</span></code></pre></figure>

<p>As you can see, if the route requires a login and <code>$rootScope.currentUser</code> is not yet set, we will prevent the attempted state change and show the modal. (I prefer to attach the <code>currentUser</code> to the <code>$rootScope</code> only because it’s an application-wide
concept. All new scopes will inherit the <code>currentUser</code> property and I can always call it from the view. Whether or not you choose to do the same is for another discussion.)</p>

<p>Additionally, it should be noted that I won’t be covering how you might store or retrieve the <code>currentUser</code> between page refreshes.</p>

<h2 id="building-the-loginmodal-service">Building the loginModal service</h2>

<p>In this post, I will wrap the <a href="http://angular-ui.github.io/bootstrap/#/modal">AngularUI Bootstrap Modal</a>; however, you can use any modal library - I have even used the same pattern in an <a href="http://ionicframework.com/">ionic</a> app
with the <code>$ionicModal</code> service. An important caveat here is that we must be able to tell the modal what to do after authentication is successful or cancelled. Preferably this is done with a promise, so that
multiple actions can be chained together. These are anonymous functions that we will use to re-submit state changes and requests after authenticating. The following is a example of how I might write such a wrapper for the <code>$modal</code> service.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// loginModal.js</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s1">&#39;loginModal&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$modal</span><span class="p">,</span> <span class="nx">$rootScope</span><span class="p">)</span> <span class="p">{</span>

  <span class="kd">function</span> <span class="nx">assignCurrentUser</span> <span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$rootScope</span><span class="p">.</span><span class="nx">currentUser</span> <span class="o">=</span> <span class="nx">user</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">user</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">instance</span> <span class="o">=</span> <span class="nx">$modal</span><span class="p">.</span><span class="nx">open</span><span class="p">({</span>
      <span class="nx">templateUrl</span><span class="o">:</span> <span class="s1">&#39;views/loginModalTemplate.html&#39;</span><span class="p">,</span>
      <span class="nx">controller</span><span class="o">:</span> <span class="s1">&#39;LoginModalCtrl&#39;</span><span class="p">,</span>
      <span class="nx">controllerAs</span><span class="o">:</span> <span class="s1">&#39;LoginModalCtrl&#39;</span>
    <span class="p">})</span>

    <span class="k">return</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">result</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">assignCurrentUser</span><span class="p">);</span>
  <span class="p">};</span>

<span class="p">});</span></code></pre></figure>

<p>There isn’t much magic in this service. It’s important to point out that <code>$modal.open</code> returns a promise which is either resolved or rejected when the modal is closed or dismissed. When a scope is instantiated for the
<code>LoginModalCtrl</code>, the <code>$close()</code> and <code>$dismiss()</code> methods are attached to it.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// LoginModalCtrl.js</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">&#39;LoginModalCtrl&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">UsersApi</span><span class="p">)</span> <span class="p">{</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">cancel</span> <span class="o">=</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">$dismiss</span><span class="p">;</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">submit</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">email</span><span class="p">,</span> <span class="nx">password</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">UsersApi</span><span class="p">.</span><span class="nx">login</span><span class="p">(</span><span class="nx">email</span><span class="p">,</span> <span class="nx">password</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">$scope</span><span class="p">.</span><span class="nx">$close</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">};</span>

<span class="p">});</span></code></pre></figure>

<p>After a successful login, the modal is closed, the <code>$rootScope.currentUser</code> is set, and the on success action will be triggered. If the user clicks the cancel button or attempts to click away from the modal, the on cancel action will step in.</p>

<h2 id="checking-in-with-the-state-change">Checking in with the state change</h2>

<p>At this point the <code>loginModal</code> can be added to the event listener. What makes this approach so slick is being able to capture the desired state transitions in anonymous functions. After authenticating, the SPA will implicitly redirect to the requested state as you would expect with a traditional web app. Additionally, notice how we will redirect to the welcome screen if a dismissal happens.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// app.js</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$rootScope</span><span class="p">,</span> <span class="nx">$state</span><span class="p">,</span> <span class="nx">loginModal</span><span class="p">)</span> <span class="p">{</span>

  <span class="nx">$rootScope</span><span class="p">.</span><span class="nx">$on</span><span class="p">(</span><span class="s1">&#39;$stateChangeStart&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">toState</span><span class="p">,</span> <span class="nx">toParams</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">requireLogin</span> <span class="o">=</span> <span class="nx">toState</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">requireLogin</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">requireLogin</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">$rootScope</span><span class="p">.</span><span class="nx">currentUser</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>

      <span class="nx">loginModal</span><span class="p">()</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">$state</span><span class="p">.</span><span class="nx">go</span><span class="p">(</span><span class="nx">toState</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">toParams</span><span class="p">);</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">$state</span><span class="p">.</span><span class="nx">go</span><span class="p">(</span><span class="s1">&#39;welcome&#39;</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">});</span>

<span class="p">});</span></code></pre></figure>

<h2 id="handling-unauthorized-requests">Handling unauthorized requests</h2>

<p>Storing a <code>currentUser</code> on the client for the lifetime of an SPA is not without its challenges. Data that is persisted in memory may become out of sync with the server and a <code>401</code> will mean your client-side authentication
is no longer valid. Perhaps the session has expired or perhaps you were never logged in to begin with. This is obviously a good time to capture the request params and show the login modal.</p>

<p>AngularJS makes <em>intercepting</em> incoming responses pretty easy with <em>interceptors</em>. Below we call the login modal when we receive a <code>401</code> response. (For the sake of brevity, we’ll assume that a <code>401</code> is the only precondition required to verify that a user is not logged in.)</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// app.js</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$httpProvider</span><span class="p">)</span> <span class="p">{</span>

  <span class="nx">$httpProvider</span><span class="p">.</span><span class="nx">interceptors</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$timeout</span><span class="p">,</span> <span class="nx">$q</span><span class="p">,</span> <span class="nx">$injector</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">loginModal</span><span class="p">,</span> <span class="nx">$http</span><span class="p">,</span> <span class="nx">$state</span><span class="p">;</span>

    <span class="c1">// this trick must be done so that we don&#39;t receive</span>
    <span class="c1">// `Uncaught Error: [$injector:cdep] Circular dependency found`</span>
    <span class="nx">$timeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="nx">loginModal</span> <span class="o">=</span> <span class="nx">$injector</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;loginModal&#39;</span><span class="p">);</span>
      <span class="nx">$http</span> <span class="o">=</span> <span class="nx">$injector</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;$http&#39;</span><span class="p">);</span>
      <span class="nx">$state</span> <span class="o">=</span> <span class="nx">$injector</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;$state&#39;</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="p">{</span>
      <span class="nx">responseError</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">rejection</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">rejection</span><span class="p">.</span><span class="nx">status</span> <span class="o">!==</span> <span class="mi">401</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">rejection</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">$q</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>

        <span class="nx">loginModal</span><span class="p">()</span>
          <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span> <span class="nx">$http</span><span class="p">(</span><span class="nx">rejection</span><span class="p">.</span><span class="nx">config</span><span class="p">)</span> <span class="p">);</span>
          <span class="p">})</span>
          <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">$state</span><span class="p">.</span><span class="nx">go</span><span class="p">(</span><span class="s1">&#39;welcome&#39;</span><span class="p">);</span>
            <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="nx">rejection</span><span class="p">);</span>
          <span class="p">});</span>

        <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">});</span>

<span class="p">});</span></code></pre></figure>

<p>With this code, a <code>401</code> rejected request will be re-submitted when a successful authentication occurs. In fact, the entity that made the original request will hang until our secondary request is completed. It’s completely oblivious to the fact that the original request was even rejected!</p>

<h2 id="conclusions">Conclusions</h2>

<p>If you’re not totally <a href="http://media.giphy.com/media/sWBOpINwXnW7K/giphy.gif">jacked up</a> right now, I feel bad for you. The modal is so clean and separated. It’s effectively a black box. What more could you want? The use of anonymous callbacks to capture the user’s intent is key to this approach. With very little code we’ve integrated a login modal that is almost completely detatched from the rest of our application, helping to minimize the number of moving parts required for authentication.</p>

<p>Please let us know what you think. Do you have suggestions for how this could be improved further? <a href="http://twitter.com/gabescholz">Tweet at me</a> or <a href="http://twitter.com/BrewhouseTeam">at us</a> or leave a comment below.</p>

<p>Special thanks to Godfrey Chan, Philippe Creux and Lana Topham for leaving feedback during the drafting of this post.</p>

<h4 id="edit-december-29-2014">Edit: December 29, 2014</h4>

<p>As per a few requests, here is what a simple <code>views/loginModalTemplate.html</code> might look like. I hope it helps to answer some questions.</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="c">&lt;!-- views/loginModalTemplate.html --&gt;</span>

<span class="nt">&lt;div&gt;</span>
  <span class="nt">&lt;form</span> <span class="na">ng-submit=</span><span class="s">&quot;LoginModalCtrl.submit(_email, _password)&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;email&quot;</span> <span class="na">ng-model=</span><span class="s">&quot;_email&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;password&quot;</span> <span class="na">ng-model=</span><span class="s">&quot;_password&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;button&gt;</span>Submit<span class="nt">&lt;/button&gt;</span>
  <span class="nt">&lt;/form&gt;</span>
  <span class="nt">&lt;button</span> <span class="na">ng-click=</span><span class="s">&quot;LoginModalCtrl.cancel()&quot;</span><span class="nt">&gt;</span>Cancel<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/div&gt;</span></code></pre></figure>

<h4 id="edit-feburary-12-2015">Edit: Feburary 12, 2015</h4>

<p>Godfrey did a write-up about <a href="http://brewhouse.io/blog/2015/02/12/ember-vs-angular-authentication">implemented the same thing using Ember.js</a>
to help compare the two frameworks. If you enjoyed this blog post, you might
like that too!</p>


        </div><!-- /post -->

        <div class="hire-us-form text-center">
  <h2>Let's Work Together</h2>
  <h3>Find out why our transparent, collaborative process is the best way to make well-loved products.</h3>
  <a href="/work-with-us.html" class="btn btn--blue">Get in touch today</a>
</div>


        <div id="disqus_thread"></div>

        <!-- disqus -->
        <script type="text/javascript">
            var disqus_shortname = 'brewhouse';
            var disqus_url = 'http://brewhouse.io/blog/2014/12/09/authentication-made-simple-in-single-page-angularjs-applications.html';

            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        <!-- /disqus -->

      </div>

  </div><!-- /content-->

</article>

<script>
  !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
</script>


    </div>

    <aside class="lets-talk cover">
  <div class="container">
    <div class="col-md-6">
      <p class="lede">We partner with businesses to design and develop well-loved products through a flexible and transparent process. We'd love to discuss how our process can help your idea become a reality.</p>
    </div>
  </div>
  <div class="container">
    <div class="col-md-6">
      <a href="mailto:hello@brewhouse.io">hello@brewhouse.io</a> &middot;
      <a href="http://twitter.com/brewhouseteam">@brewhouseteam</a>
    </div>
    <div class="col-md-5 col-md-offset-1">
      <a href="/work-with-us.html" class="btn btn--footer">Hire Us</a>
    </div>
  </div>
</aside>


    <footer id="footer">
  <div class="container">
    <nav role="navigation" class="col-md-6">
        <ul>
          <li>
            <a class="internal" href="/meet-the-team.html">Team</a>
          </li>
          <li>
            <a class="internal" href="/blog">Blog</a>
          </li>
          <li>
            <a class="internal" href="/show">Podcast</a>
          </li>
        </ul>
    </nav>
    <div class="col-md-5 col-md-push-1">
      <p class="copyright">
        &copy; <span class="copyright-year"></span> <a href="http://brewhouse.io">brewhouse software, inc.</a>
      </p>
    </div>
  </div>
</footer>


    <script type="text/javascript" src="/assets/app.js"></script>

    <!-- needs to be refactored when we have more layouts -->
    

  </body>
</html>
