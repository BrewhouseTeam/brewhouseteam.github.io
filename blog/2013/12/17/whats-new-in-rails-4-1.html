

<!-- Nice to see you took a peek here, hello -->
<!-- send us an email at hello at brewhouse dot io if you want to talk tech -->

<!DOCTYPE html>
<!--[if lt IE 7 ]> <html class="ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]>    <html class="ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]>    <html class="ie8" lang="en"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie9" lang="en"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en"> <!--<![endif]-->

<html lang="en-us" class="blog">
  <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# business: http://ogp.me/ns/business#">
    <title>What's new in Rails 4.1 - the brew pub - brewhouse software blog</title>
    <meta property="og:title" content="What's new in Rails 4.1 - the brew pub - brewhouse software blog">
    
      <meta name="description" content="This was originally published on the Coherence blog on December 17th, 2013. It has been migrated here for historical purposes. In case you haven't been paying attention, Rails 4.1 beta [was released today][weblog-post]! While this is a minor release, there are still plenty of handy new features that's worth getting excited about. Here are a few of my favourites, along with some thoughts on why I think they are useful. (This post is based on my lightning talk at [#VANRUBY][vanruby],...">
      <meta name="og:description" content="This was originally published on the Coherence blog on December 17th, 2013. It has been migrated here for historical purposes. In case you haven't been paying attention, Rails 4.1 beta [was released today][weblog-post]! While this is a minor release, there are still plenty of handy new features that's worth getting excited about. Here are a few of my favourites, along with some thoughts on why I think they are useful. (This post is based on my lightning talk at [#VANRUBY][vanruby],...">
    

    <link rel="alternate" type="application/atom+xml" href="/blog/index.xml" title="The Brew Pub atom feed">

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="brewhouse.io">
<meta name="copyright" content="brewhouse software inc. 2014">
<meta name="robots" content="INDEX, FOLLOW">

<meta property="og:site_name" content="brewhouse">
<meta property="og:url" content="http://brewhouse.io/blog/2013/12/17/whats-new-in-rails-4-1.html">
<meta property="og:type" content="business.business">
<meta property="og:image" content="http://brewhouse.io/images/brewhouse-symbol-large-200x200.png">
<meta property="business:contact_data:street_address" content="55 E Cordova St - Unit 604">
<meta property="business:contact_data:locality" content="Vancouver, BC">
<meta property="business:contact_data:postal_code" content="V6A 0A5">
<meta property="business:contact_data:country_name" content="Canada">
<meta property="place:location:latitude" content="49.282471">
<meta property="place:location:longitude" content="-123.103046">

<link rel="shortcut icon" href="/images/icons/favicon.ico" type="image/x-icon">
<link rel="apple-touch-icon" href="/images/icons/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="57x57" href="/images/icons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="72x72" href="/images/icons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/images/icons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/images/icons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/images/icons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/images/icons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/images/icons/apple-touch-icon-152x152.png">

<link href="http://fonts.googleapis.com/css?family=Lato:300,400" rel="stylesheet" type="text/css">

<link rel="stylesheet" href="/assets/application-68e3557633887359967668922102e356.css">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/foundicons/3.0.0/foundation-icons.css">

  </head>
  <body class="on-post">
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46725009-2', 'brewhouse.io');
  ga('send', 'pageview');

</script>


    <nav id="navbar-blog" class="navbar navbar-default navbar-main" role="navigation">
      <a id="brewhouse-logo" class="navbar-brand internal" rel="home" href="/" title="brewhouse logo"><img src="/images/brewhouse-logo-blog-2.png"></a>
    </nav>

    <div class="container main">
      <div id="banner-blog" class="row">
  <div class="col-xs-12 img-full-width">
    <img src="/images/blog-background.jpg" class="img-responsive">

    <section>
      <h1 id="brew-pub-start">
        <a href="http://brewhouse.io/blog/">The Brew Pub</a>
      </h1>
      <h3>
        Writings from <a href="http://brewhouse.io">brewhouse.io</a>, makers of <a href="https://goodbits.io?utm_source=brewhouse-blog">goodbits.io</a> and stellar apps for our clients.
      </h3>
    </section>
  </div>
</div>


      

<div id="article-start" class="content">
  <div class="row">
    <div class="col-xs-12 col-sm-9">

      <div class="post">
        <div class="social-actions">
          <a href="https://twitter.com/share?via=BrewhouseTeam" class="twitter-share-button" data-lang="en" data-url="http://brewhouse.io/blog/2013/12/17/whats-new-in-rails-4-1.html" data-related="chancancode,kalv,pcreux,chuckbergeron" data-counturl="http://coherence.io/blog/2013/12/17/whats-new-in-rails-4-1.html">Tweet</a>
        </div>

        <h1>
          What's new in Rails 4.1
        </h1>
        <p class="meta">
          
            <span>
              <img class="img-circle img-author" src="//www.gravatar.com/avatar/560f36d69534a1a58d0f12dad39b0396?s=135" alt="A photo of Godfrey Chan" width="55">

              <a href="http://twitter.com/chancancode" target="_blank">Godfrey Chan</a> wrote this on 17 Dec 2013
            </span>
          
        </p>

        <blockquote><em>This was originally published on the Coherence blog on December 17th, 2013. It has been migrated here for historical purposes.</em></blockquote>

<p>In case you haven’t been paying attention, Rails 4.1 beta <a href="http://weblog.rubyonrails.org/">was released today</a>!
While this is a minor release, there are still plenty of handy new features
that’s worth getting excited about. Here are a few of my favourites, along with
some thoughts on why I think they are useful.</p>

<p>(This post is based on my lightning talk at <a href="http://vanruby.org/">#VANRUBY</a>, the original
slides can be found <a href="http://www.slideshare.net/godfreykfc/rails-41">here</a>.)</p>

<h2 id="action-mailer-previews">Action Mailer Previews</h2>

<p>Testing email templates in Rails has always been pretty painful. My current
workflow involves:</p>

<ol>
  <li>Make changes to the email template</li>
  <li>Deliver the email via the rails console</li>
  <li>Check the output in the browser</li>
  <li>Rinse and repeat</li>
</ol>

<p>The <a href="https://github.com/ryanb/letter_opener">Letter Opener</a> gem makes this easier, but this is still far
from ideal. Fortunately for us, <a href="https://github.com/pixeltrix">@pixeltrix</a> did
the hard work to integrate the <a href="https://github.com/37signals/mail_view">MailView</a> gem into Rails 4.1. You
can now easily create previews for your mailers and view them in the browser
from <code>http://localhost:3000/rails/mailers</code>:</p>

<div class="highlight"><pre><code class="ruby"><span class="c1"># In /test/mailers/previews/notifier_preview.rb</span>
<span class="k">class</span> <span class="nc">NotifierPreview</span> <span class="o">&lt;</span> <span class="no">ActionMailer</span><span class="o">::</span><span class="no">Preview</span>
  <span class="k">def</span> <span class="nf">welcome</span>
    <span class="c1"># Mock up some data for the preview</span>
    <span class="n">user</span> <span class="o">=</span> <span class="no">FactoryGirl</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span>

    <span class="c1"># Return a Mail::Message here (but don&#39;t deliver it!)</span>
    <span class="no">Notifier</span><span class="o">.</span><span class="n">welcome</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>

<p>It should be noted that although the preview files live under the test
directory by default (which can be changed via <code>config.action_mailer.preview_path</code>),
it is actually run inside the development environment. So if you need to use
gems like <code>FactoryGirl</code> to generate fake data, you’ll need to make sure they
are added to the development group in your Gemfile as well.</p>

<p>If your app doesn’t currently have a <code>test</code> folder (i.e. <code>rspec</code> users), it
might be tempting to change the default <code>config.action_mailer.preview_path</code>
to something like <code>/app/mailer/previews</code>. However, please be aware that the
<code>/app</code> folder is eager-loaded in production, so that’s probably not the best
place to put these preview files.</p>

<p>Read more about this feature:</p>

<ul>
  <li><a href="http://edgeguides.rubyonrails.org/4_1_release_notes.html#action-mailer-previews">Release notes</a></li>
  <li><a href="http://edgeapi.rubyonrails.org/classes/ActionMailer/Base.html">Documentation</a></li>
  <li>Pull request: <a href="https://github.com/rails/rails/pull/13332">#13332</a></li>
</ul>

<h2 id="active-record-enums">Active Record Enums</h2>

<p>Have you ever used multiple <code>boolean</code> columns to compose a single complex state
on your models? I’ve definitely done this before and things get out of
hand really quickly.</p>

<p>Enums to the rescue!</p>

<div class="highlight"><pre><code class="ruby"><span class="k">class</span> <span class="nc">Bug</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="c1"># Relevant schema change looks like this:</span>
  <span class="c1">#</span>
  <span class="c1"># create_table :bugs do |t|</span>
  <span class="c1">#   t.column :status, :integer, default: 0 # defaults to the first value (i.e. :new)</span>
  <span class="c1"># end</span>

  <span class="n">enum</span> <span class="ss">status</span><span class="p">:</span> <span class="o">[</span> <span class="ss">:new</span><span class="p">,</span> <span class="ss">:assigned</span><span class="p">,</span> <span class="ss">:in_progress</span><span class="p">,</span> <span class="ss">:resolved</span><span class="p">,</span> <span class="ss">:rejected</span><span class="p">,</span> <span class="ss">:reopened</span> <span class="o">]</span>

  <span class="n">belongs_to</span> <span class="ss">:assignee</span><span class="p">,</span> <span class="n">class_name</span><span class="p">:</span> <span class="s1">&#39;Developer&#39;</span>

  <span class="k">def</span> <span class="nf">assignee</span><span class="o">=</span><span class="p">(</span><span class="n">developer</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">developer</span> <span class="o">&amp;&amp;</span> <span class="nb">self</span><span class="o">.</span><span class="n">new?</span>
      <span class="nb">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="ss">:assigned</span>
    <span class="k">else</span>
      <span class="nb">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="ss">:new</span>
    <span class="k">end</span>

    <span class="k">super</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">Bug</span><span class="o">.</span><span class="n">resolved</span>           <span class="c1"># =&gt; a scope to find all resolved bugs</span>

<span class="n">bug</span><span class="o">.</span><span class="n">resolved?</span>          <span class="c1"># =&gt; check if bug has the status :resolved</span>

<span class="n">bug</span><span class="o">.</span><span class="n">resolved!</span>          <span class="c1"># =&gt; update! the bug with status set to :resolved</span>

<span class="n">bug</span><span class="o">.</span><span class="n">status</span>             <span class="c1"># =&gt; a symbol describing the bug&#39;s status</span>

<span class="n">bug</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="ss">:resolved</span> <span class="c1"># =&gt; set the bug&#39;s status to :resolved</span>
</code></pre></div>

<p>Internally, these states are mapped to integers in the database to
save space. It’s also worth mentioning that the methods added by the <code>enum</code>
macro are mixed-in via a module. This means you can easily override them in
your model and use <code>super</code> to reach the original implementation.</p>

<p>There are a few caveats you should keep in mind when using this feature:</p>

<p><strong>I</strong>. Despite its name, this feature doesn’t actually use the <code>ENUM</code> type that is
   implemented in certain databases. The mapping between states
   and their corresponding integers are maintained in the Ruby model file.
   This means that you should not change the order of the <code>enum</code> symbols once
   they are added. To remove unused states, you can use an explicit mapping:</p>

<div class="highlight"><pre><code class="ruby"><span class="k">class</span> <span class="nc">Bug</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">enum</span> <span class="ss">status</span><span class="p">:</span> <span class="p">{</span>
    <span class="kp">new</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">in_progress</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="ss">resolved</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="ss">rejected</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="ss">reopened</span><span class="p">:</span> <span class="mi">5</span>
  <span class="p">}</span>
<span class="k">end</span>
</code></pre></div>

<p><strong>II</strong>. Avoid using the same names inside different enums in the same class!
   Doing so will leave Active Record very confused!</p>

<div class="highlight"><pre><code class="ruby"><span class="k">class</span> <span class="nc">Bug</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">enum</span> <span class="ss">status</span><span class="p">:</span> <span class="o">[</span> <span class="ss">:new</span><span class="p">,</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="o">]</span>
  <span class="n">enum</span> <span class="n">code_review_status</span><span class="p">:</span> <span class="o">[</span> <span class="ss">:new</span><span class="p">,</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="o">]</span> <span class="c1"># WARNING: Don&#39;t do this!</span>
<span class="k">end</span>
</code></pre></div>

<p><strong>III</strong>. If you need to write custom scopes to query the enum columns, you would have
   to pass the integers instead of the symbols. You can access the enum-integer
   mapping via a constant added by the macro:</p>

<div class="highlight"><pre><code class="ruby"><span class="k">class</span> <span class="nc">Bug</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">scope</span> <span class="ss">:open</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">{</span>
    <span class="n">where</span><span class="p">(</span><span class="s1">&#39;status &lt;&gt; ? OR status &lt;&gt; ?&#39;</span><span class="p">,</span> <span class="no">STATUS</span><span class="o">[</span><span class="ss">:resolved</span><span class="o">]</span><span class="p">,</span> <span class="no">STATUS</span><span class="o">[</span><span class="ss">:rejected</span><span class="o">]</span><span class="p">)</span>
  <span class="p">}</span>
<span class="k">end</span>
</code></pre></div>

<p><strong>IV</strong>. Currently, the dirty tracking methods (e.g. <code>status_was?</code>) have not been
   updated to work with enums yet (they currently return the mapped integer
   instead of the symbols). This should be fixed before the final release. (See
   <a href="https://github.com/rails/rails/pull/13267">#13267</a> for the progress.)</p>

<p>Read more about this feature:</p>

<ul>
  <li><a href="http://edgeguides.rubyonrails.org/4_1_release_notes.html#active-record-enums">Release notes</a></li>
  <li><a href="http://edgeapi.rubyonrails.org/classes/ActiveRecord/Enum.html">Documentation</a></li>
  <li>Original commit: <a href="https://github.com/rails/rails/commit/db41eb8a6ea88b854bf5cd11070ea4245e1639c5">db41eb8a</a></li>
</ul>

<h2 id="action-pack-variants">Action Pack Variants</h2>

<p>As web developers, we are well aware that we have fully transitioned into the
<a href="http://en.wikipedia.org/wiki/Post-PC_era">post-PC era</a>. As much as I love <a href="http://alistapart.com/article/responsive-web-design">responsive design</a>,
it is not a silver bullet for the multi-device web. In many cases, it is more
appropiate to tailor your views to serve the most relevant content and workflow
for specific device categories.</p>

<p>With <strong>Action Pack Variants</strong>, this will become much easier in Rails 4.1:</p>

<div class="highlight"><pre><code class="ruby"><span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">before_action</span> <span class="ss">:detect_device_variant</span>

  <span class="kp">private</span>

    <span class="k">def</span> <span class="nf">detect_device_variant</span>
      <span class="k">case</span> <span class="n">request</span><span class="o">.</span><span class="n">user_agent</span>
      <span class="k">when</span> <span class="sr">/iPad/i</span>
        <span class="n">request</span><span class="o">.</span><span class="n">variant</span> <span class="o">=</span> <span class="ss">:tablet</span>
      <span class="k">when</span> <span class="sr">/iPhone/i</span>
        <span class="n">request</span><span class="o">.</span><span class="n">variant</span> <span class="o">=</span> <span class="ss">:phone</span>
      <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">PostController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@post</span> <span class="o">=</span> <span class="no">Post</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>

    <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
      <span class="nb">format</span><span class="o">.</span><span class="n">json</span>
      <span class="nb">format</span><span class="o">.</span><span class="n">html</span>               <span class="c1"># /app/views/posts/show.html.erb</span>
      <span class="nb">format</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">phone</span>         <span class="c1"># /app/views/posts/show.html+phone.erb</span>
      <span class="nb">format</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">tablet</span> <span class="k">do</span>
        <span class="vi">@show_edit_link</span> <span class="o">=</span> <span class="kp">false</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>

<p>This example sets up a <code>before_action</code> filter to match the <code>User-Agent</code> HTTP
header against certain keywords, and assign the <code>request.variant</code> accordingly.
By specifying the supported variants in the <code>respond_to</code> block, Rails will
render the appropiate template for the specific format and variant combination.
It also allows you to run additional variant-specific code by passing a block.</p>

<p>In fact, you can even skip the declaration - if you have the appropiate
template in your <code>views</code> directory, Rails will automatically pick it up. On the
other hand, if a variant does not have a specialized template, Rails will
fallback to the default template for the format (i.e. <code>show.html.erb</code>). This
allows you to share a template between two variants. In this example, the
<code>tablet</code> variant will reuse the default template if <code>/app/views/posts/show.html+phone.erb</code>
is absent.</p>

<p>Although most examples use the <code>User-Agent</code> header to showcase this feature,
it’s worth noting that the actual implementation in Rails is completely
agnostic from that. <code>request.variant</code> can be assigned any time before the
template is rendered based on arbitrary conditions, such as the request
(sub)domain, HTTP headers, session data, or even the result of a coin flip.</p>

<p>This makes the feature very flexible, and can potentially be used for many
things such as API versioning, A/B testing, or even feature rollouts!</p>

<p>Read more about this feature:</p>

<ul>
  <li><a href="http://edgeguides.rubyonrails.org/4_1_release_notes.html#variants">Release notes</a></li>
  <li><a href="http://edgeapi.rubyonrails.org/classes/ActionController/MimeResponds.html#method-i-respond_to">Documentation</a></li>
  <li>Pull requests: <a href="https://github.com/rails/rails/pull/12977">#12977</a>, <a href="https://github.com/rails/rails/pull/13290">#13290</a></li>
</ul>

<h2 id="application-message-verifier">Application Message Verifier</h2>

<p>Rails 4.1 also included a built-in helper to generate signed messages with
<a href="http://en.wikipedia.org/wiki/Hash-based_message_authentication_code">HMAC</a>. The message verifier was previously used to power things like
signed cookies, but it is now much easier to use it for other purposes.</p>

<p>For example, you can implement a stateless “reset password” feature without
having to store any tokens in the database:</p>

<div class="highlight"><pre><code class="ruby"><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span>
    <span class="k">def</span> <span class="nf">verifier_for</span><span class="p">(</span><span class="n">purpose</span><span class="p">)</span>
      <span class="vi">@verifiers</span> <span class="o">||=</span> <span class="p">{}</span>
      <span class="vi">@verifiers</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">purpose</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="nb">p</span><span class="o">|</span>
        <span class="vi">@verifiers</span><span class="o">[</span><span class="nb">p</span><span class="o">]</span> <span class="o">=</span> <span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">message_verifier</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="nb">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">-</span><span class="si">#{</span><span class="nb">p</span><span class="o">.</span><span class="n">to_s</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">reset_password_token</span>
    <span class="n">verifier</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">verifier_for</span><span class="p">(</span><span class="s1">&#39;reset-password&#39;</span><span class="p">)</span> <span class="c1"># Unique for each type of messages</span>
    <span class="n">verifier</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="o">[</span><span class="nb">id</span><span class="p">,</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">]</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">reset_password!</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">new_password</span><span class="p">,</span> <span class="n">new_password_confirmation</span><span class="p">)</span>
    <span class="c1"># This raises an exception if the message is modified</span>
    <span class="n">user_id</span><span class="p">,</span> <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">verifier_for</span><span class="p">(</span><span class="s1">&#39;reset-password&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">verify</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">timestamp</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="o">.</span><span class="n">day</span><span class="o">.</span><span class="n">ago</span>
      <span class="nb">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">new_password</span>
      <span class="nb">self</span><span class="o">.</span><span class="n">password_confirmation</span> <span class="o">=</span> <span class="n">new_password_confirmation</span>
      <span class="n">save!</span>
    <span class="k">else</span>
      <span class="c1"># Token expired</span>
      <span class="c1"># ...</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Notifier</span> <span class="o">&lt;</span> <span class="no">ActionMailer</span><span class="o">::</span><span class="no">Base</span>
  <span class="k">def</span> <span class="nf">reset_password</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="n">user</span>
    <span class="vi">@reset_password_url</span> <span class="o">=</span> <span class="n">password_reset_url</span><span class="p">(</span><span class="ss">token</span><span class="p">:</span> <span class="vi">@user</span><span class="o">.</span><span class="n">reset_password_token</span><span class="p">)</span>
    <span class="n">mail</span><span class="p">(</span><span class="ss">to</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="ss">subject</span><span class="p">:</span> <span class="s2">&quot;Your have requested to reset your password&quot;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>

<p>That way, everything that is required to fufill the password reset request is
included in the link, nothing need to be stored in the database. This can also
be used for things like <code>OAuth</code> (the <code>state</code> parameter).</p>

<p>When using this feature, it is important to conisder possible <a href="http://en.wikipedia.org/wiki/Replay_attack">replay attacks</a>.
In the example above, if we did not include a timestamp to check for expiration,
the same URL can be used to reset the user’s password at any time if the email
ended up in the wrong hands!</p>

<p>Also, the key used to sign the message is derived from your application’s
<code>secret_key_base</code> and the “salt” you passed (<code>"User-reset-password"</code> in the
example). Changing either will invalidate any previously signed messages.</p>

<h2 id="spring">Spring</h2>

<p>Depending on the gems you use, an average Rails app probably take around ~5
seconds to boot. That’s 5 seconds wasted every time you run your tests, even
when you are just running a single isolated test case! If you are following
<a href="http://en.wikipedia.org/wiki/Test-driven_development">TDD</a>, you are probably doing this 50 times a day. That’s <a href="http://xkcd.com/1205/">5 days wasted</a>
in the last five years!</p>

<p>Luckily for all of us, new applications generated with Rails 4.1 comes with
built-in integration with the <a href="https://github.com/jonleighton/spring">Spring</a> application preloader.</p>

<p>Spring works by keeping your application running in the background so you
don’t need to boot it every time you run a test, rake task or migration. If
you are familiar with <a href="https://github.com/burke/zeus">Zeus</a> gem or the <a href="https://github.com/sporkrb/spork">Spork</a> gem, this should
sound famaliar. However, it transparently wraps common Rails commands
(<code>rake</code> and <code>rails</code> by default) with binstubs, so if you have <code>./bin</code>
in your <code>PATH</code>, things should automagically become much faster for you, no
actions required!</p>

<p>I tried this on the <a href="https://caliper.io/">Caliper</a> dashboard, and we can save almost 5
seconds between test runs when spring is loaded. Can I get my 5 extra days
off now? ;)</p>

<p>You can read about how it works in the <a href="https://github.com/jonleighton/spring#readme">Spring README</a> as
well as how to install this for existing applications.</p>

<p>Read more about this feature:</p>

<ul>
  <li><a href="http://edgeguides.rubyonrails.org/4_1_release_notes.html#spring-application-preloader">Release notes</a></li>
  <li><a href="http://edgeguides.rubyonrails.org/upgrading_ruby_on_rails.html#spring">Upgrading guide</a></li>
  <li><a href="https://github.com/jonleighton/spring#readme">Documentation</a></li>
  <li>Pull request: <a href="https://github.com/rails/rails/pull/12958">#12958</a></li>
</ul>

<h2 id="even-more-features">Even More Features</h2>

<p>This is just scratching the surface of this release. There are many other
features that you might find useful, such as
<a href="http://edgeguides.rubyonrails.org/4_1_release_notes.html#config-secrets-yml">a <code>secrets.yml</code> for all your secrets</a>,
<a href="https://github.com/rails/rails/pull/12824">time travelling in tests</a>,
<a href="https://github.com/rails/rails/pull/12183">better JSON handling</a>,
<a href="http://edgeguides.rubyonrails.org/4_1_release_notes.html#module-concerning"><code>Module#concerning</code></a>,
<a href="https://github.com/rails/rails/pull/12891"><code>to_param</code> macro</a> and more.
I encourage you to checkout the <a href="http://edgeguides.rubyonrails.org/4_1_release_notes.html">release notes</a>
for a full list of changes!</p>

<h2 id="vanruby-upgrade-clinic">#VANRUBY Upgrade Clinic</h2>

<p>We will be running our <a href="http://www.meetup.com/vancouver-ruby/messages/61805312/">4.1 upgrade clinic</a>
again at the <a href="http://www.meetup.com/vancouver-ruby/events/154207602/">#VANRUBY hack night</a>
today. Stop by and say hi if you are in town!</p>



        <div class="mailchimp-form text-center">
          <p>
            Enter your email below and receive more from the BrewPub:
          </p>
          <!-- Begin MailChimp Signup Form -->
          <link href="//cdn-images.mailchimp.com/embedcode/slim-081711.css" rel="stylesheet" type="text/css">
          <div id="mc_embed_signup" class="row">
            <form action="http://brewhouse.us8.list-manage.com/subscribe/post?u=c524f6473f5901cae1230a052&amp;id=14f9de4be1" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>

              <div class="col-sm-8">
                <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required style="width: 100%; margin: 0 0 4% 0">
              </div>
              <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
              <div style="position: absolute; left: -5000px;">
                <input type="text" name="b_c524f6473f5901cae1230a052_14f9de4be1" value="">
              </div>

              <div class="col-sm-4 subscribe-button">
                <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button">
              </div>
            </form>
          </div>
          <!--End mc_embed_signup-->
        </div>

        <div id="disqus_thread"></div>

        <!-- disqus -->
        <script type="text/javascript">
            var disqus_shortname = 'brewhouse';
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        <!-- /disqus -->

      </div><!-- /post -->

    </div>
  </div><!-- /row -->
</div><!-- /content-->

<script>
  !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
</script>

    </div>

    <footer>
      <div class="container">
        <div class="row">
          <div class="col-xs-11 col-xs-offset-1">
            <p>
              &copy; 2014 <a href="http://brewhouse.io">brewhouse software, inc.</a>
            </p>
          </div><!--col-xs-12 -->
        </div><!-- row -->
      </div><!-- container -->
    </footer>

    <script src="/assets/app-d2b50542eb2234dffdd5932a70b4af3b.js"></script>
  </body>
</html>
